{
  "id": null,
  "uid": "worst-offenders",
  "title": "Worst Offenders \u2014 Core Web Vitals",
  "tags": ["crux", "cwv", "worst"],
  "schemaVersion": 40,
  "version": 1,
  "editable": true,
  "graphTooltip": 0,
  "fiscalYearStartMonth": 0,
  "liveNow": false,
  "refresh": "",
  "time": {
    "from": "now-2y",
    "to": "now"
  },
  "timepicker": {},
  "templating": {
    "list": [
      {
        "name": "device",
        "label": "Device",
        "type": "custom",
        "query": "phone,desktop,tablet",
        "current": {
          "text": ["phone", "desktop", "tablet"],
          "value": ["phone", "desktop", "tablet"],
          "selected": true
        },
        "options": [
          { "text": "phone", "value": "phone", "selected": true },
          { "text": "desktop", "value": "desktop", "selected": true },
          { "text": "tablet", "value": "tablet", "selected": true }
        ],
        "multi": true,
        "includeAll": false,
        "hide": 0,
        "skipUrlSync": false
      }
    ]
  },
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": { "type": "grafana", "uid": "-- Grafana --" },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "panels": [
    {
      "type": "row",
      "title": "CWV Distribution",
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 },
      "id": 100,
      "panels": []
    },
    {
      "id": 1,
      "title": "LCP Distribution",
      "type": "gauge",
      "gridPos": { "h": 6, "w": 8, "x": 0, "y": 1 },
      "datasource": { "type": "grafana-bigquery-datasource", "uid": "dealeron-bigquery" },
      "targets": [
        {
          "refId": "A",
          "datasource": { "type": "grafana-bigquery-datasource", "uid": "dealeron-bigquery" },
          "rawSql": "SELECT\n  ROUND(AVG(SAFE_DIVIDE(fast_lcp, fast_lcp + avg_lcp + slow_lcp)) * 100, 1) as good,\n  ROUND(AVG(SAFE_DIVIDE(avg_lcp, fast_lcp + avg_lcp + slow_lcp)) * 100, 1) as needs_improvement,\n  ROUND(AVG(SAFE_DIVIDE(slow_lcp, fast_lcp + avg_lcp + slow_lcp)) * 100, 1) as poor\nFROM `dealeron-crux.dealeron_crux.cwv_monthly`\nWHERE yyyymm = (SELECT MAX(yyyymm) FROM `dealeron-crux.dealeron_crux.cwv_monthly`)\nAND device IN (${device:sqlstring})\nAND fast_lcp IS NOT NULL",
          "rawQuery": true,
          "editorMode": "code",
          "format": 1
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "min": 0,
          "max": 100
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "good" },
            "properties": [
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    { "color": "red", "value": null },
                    { "color": "yellow", "value": 50 },
                    { "color": "green", "value": 75 }
                  ]
                }
              }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "needs_improvement" },
            "properties": [
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    { "color": "green", "value": null },
                    { "color": "yellow", "value": 15 },
                    { "color": "red", "value": 30 }
                  ]
                }
              }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "poor" },
            "properties": [
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    { "color": "green", "value": null },
                    { "color": "yellow", "value": 10 },
                    { "color": "red", "value": 25 }
                  ]
                }
              }
            ]
          }
        ]
      },
      "options": {
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "orientation": "auto",
        "showThresholdLabels": false,
        "showThresholdMarkers": true
      }
    },
    {
      "id": 2,
      "title": "INP Distribution",
      "type": "gauge",
      "gridPos": { "h": 6, "w": 8, "x": 8, "y": 1 },
      "datasource": { "type": "grafana-bigquery-datasource", "uid": "dealeron-bigquery" },
      "targets": [
        {
          "refId": "A",
          "datasource": { "type": "grafana-bigquery-datasource", "uid": "dealeron-bigquery" },
          "rawSql": "SELECT\n  ROUND(AVG(SAFE_DIVIDE(fast_inp, fast_inp + avg_inp + slow_inp)) * 100, 1) as good,\n  ROUND(AVG(SAFE_DIVIDE(avg_inp, fast_inp + avg_inp + slow_inp)) * 100, 1) as needs_improvement,\n  ROUND(AVG(SAFE_DIVIDE(slow_inp, fast_inp + avg_inp + slow_inp)) * 100, 1) as poor\nFROM `dealeron-crux.dealeron_crux.cwv_monthly`\nWHERE yyyymm = (SELECT MAX(yyyymm) FROM `dealeron-crux.dealeron_crux.cwv_monthly`)\nAND device IN (${device:sqlstring})\nAND fast_inp IS NOT NULL",
          "rawQuery": true,
          "editorMode": "code",
          "format": 1
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "min": 0,
          "max": 100
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "good" },
            "properties": [
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    { "color": "red", "value": null },
                    { "color": "yellow", "value": 50 },
                    { "color": "green", "value": 75 }
                  ]
                }
              }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "needs_improvement" },
            "properties": [
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    { "color": "green", "value": null },
                    { "color": "yellow", "value": 15 },
                    { "color": "red", "value": 30 }
                  ]
                }
              }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "poor" },
            "properties": [
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    { "color": "green", "value": null },
                    { "color": "yellow", "value": 10 },
                    { "color": "red", "value": 25 }
                  ]
                }
              }
            ]
          }
        ]
      },
      "options": {
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "orientation": "auto",
        "showThresholdLabels": false,
        "showThresholdMarkers": true
      }
    },
    {
      "id": 3,
      "title": "CLS Distribution",
      "type": "gauge",
      "gridPos": { "h": 6, "w": 8, "x": 16, "y": 1 },
      "datasource": { "type": "grafana-bigquery-datasource", "uid": "dealeron-bigquery" },
      "targets": [
        {
          "refId": "A",
          "datasource": { "type": "grafana-bigquery-datasource", "uid": "dealeron-bigquery" },
          "rawSql": "SELECT\n  ROUND(AVG(SAFE_DIVIDE(small_cls, small_cls + medium_cls + large_cls)) * 100, 1) as good,\n  ROUND(AVG(SAFE_DIVIDE(medium_cls, small_cls + medium_cls + large_cls)) * 100, 1) as needs_improvement,\n  ROUND(AVG(SAFE_DIVIDE(large_cls, small_cls + medium_cls + large_cls)) * 100, 1) as poor\nFROM `dealeron-crux.dealeron_crux.cwv_monthly`\nWHERE yyyymm = (SELECT MAX(yyyymm) FROM `dealeron-crux.dealeron_crux.cwv_monthly`)\nAND device IN (${device:sqlstring})\nAND small_cls IS NOT NULL",
          "rawQuery": true,
          "editorMode": "code",
          "format": 1
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "min": 0,
          "max": 100
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "good" },
            "properties": [
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    { "color": "red", "value": null },
                    { "color": "yellow", "value": 50 },
                    { "color": "green", "value": 75 }
                  ]
                }
              }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "needs_improvement" },
            "properties": [
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    { "color": "green", "value": null },
                    { "color": "yellow", "value": 15 },
                    { "color": "red", "value": 30 }
                  ]
                }
              }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "poor" },
            "properties": [
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    { "color": "green", "value": null },
                    { "color": "yellow", "value": 10 },
                    { "color": "red", "value": 25 }
                  ]
                }
              }
            ]
          }
        ]
      },
      "options": {
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "orientation": "auto",
        "showThresholdLabels": false,
        "showThresholdMarkers": true
      }
    },
    {
      "type": "row",
      "title": "Worst LCP Sites",
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 7 },
      "id": 101,
      "panels": []
    },
    {
      "id": 4,
      "title": "Worst LCP \u2014 Top 25",
      "description": "Sites with the highest P75 Largest Contentful Paint (threshold: 2500ms good, 4000ms poor)",
      "type": "table",
      "gridPos": { "h": 12, "w": 24, "x": 0, "y": 8 },
      "datasource": { "type": "grafana-bigquery-datasource", "uid": "dealeron-bigquery" },
      "targets": [
        {
          "refId": "A",
          "datasource": { "type": "grafana-bigquery-datasource", "uid": "dealeron-bigquery" },
          "rawSql": "SELECT\n  origin,\n  dealer_name,\n  oem_brand,\n  state,\n  device,\n  ROUND(p75_lcp, 0) as p75_lcp,\n  ROUND(p75_inp, 0) as p75_inp,\n  ROUND(p75_cls, 2) as p75_cls,\n  CASE\n    WHEN p75_lcp <= 2500 AND p75_inp <= 200 AND p75_cls <= 0.10 THEN 'PASS'\n    ELSE 'FAIL'\n  END as cwv_status\nFROM `dealeron-crux.dealeron_crux.cwv_monthly`\nWHERE yyyymm = (SELECT MAX(yyyymm) FROM `dealeron-crux.dealeron_crux.cwv_monthly`)\nAND device IN (${device:sqlstring})\nAND p75_lcp IS NOT NULL\nORDER BY p75_lcp DESC\nLIMIT 25",
          "rawQuery": true,
          "editorMode": "code",
          "format": 1
        }
      ],
      "fieldConfig": {
        "defaults": {},
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "p75_lcp" },
            "properties": [
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    { "color": "green", "value": null },
                    { "color": "yellow", "value": 2500 },
                    { "color": "red", "value": 4000 }
                  ]
                }
              },
              { "id": "custom.displayMode", "value": "color-background" },
              { "id": "custom.cellOptions", "value": { "type": "color-background" } }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "p75_inp" },
            "properties": [
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    { "color": "green", "value": null },
                    { "color": "yellow", "value": 200 },
                    { "color": "red", "value": 500 }
                  ]
                }
              },
              { "id": "custom.displayMode", "value": "color-background" },
              { "id": "custom.cellOptions", "value": { "type": "color-background" } }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "p75_cls" },
            "properties": [
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    { "color": "green", "value": null },
                    { "color": "yellow", "value": 0.10 },
                    { "color": "red", "value": 0.25 }
                  ]
                }
              },
              { "id": "custom.displayMode", "value": "color-background" },
              { "id": "custom.cellOptions", "value": { "type": "color-background" } }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "cwv_status" },
            "properties": [
              {
                "id": "mappings",
                "value": [
                  { "type": "value", "options": { "PASS": { "text": "PASS", "color": "green" }, "FAIL": { "text": "FAIL", "color": "red" } } }
                ]
              },
              { "id": "custom.displayMode", "value": "color-background" },
              { "id": "custom.cellOptions", "value": { "type": "color-background" } }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "origin" },
            "properties": [
              {
                "id": "links",
                "value": [
                  {
                    "title": "Drilldown",
                    "url": "/d/site-drilldown/site-drilldown?var-origin=${__data.fields.origin}&from=now-2y&to=now"
                  }
                ]
              }
            ]
          }
        ]
      },
      "options": {
        "showHeader": true,
        "sortBy": [
          { "displayName": "p75_lcp", "desc": true }
        ],
        "footer": { "show": false }
      }
    },
    {
      "type": "row",
      "title": "Worst INP Sites",
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 20 },
      "id": 102,
      "panels": []
    },
    {
      "id": 5,
      "title": "Worst INP \u2014 Top 25",
      "description": "Sites with the highest P75 Interaction to Next Paint (threshold: 200ms good, 500ms poor)",
      "type": "table",
      "gridPos": { "h": 12, "w": 24, "x": 0, "y": 21 },
      "datasource": { "type": "grafana-bigquery-datasource", "uid": "dealeron-bigquery" },
      "targets": [
        {
          "refId": "A",
          "datasource": { "type": "grafana-bigquery-datasource", "uid": "dealeron-bigquery" },
          "rawSql": "SELECT\n  origin,\n  dealer_name,\n  oem_brand,\n  state,\n  device,\n  ROUND(p75_inp, 0) as p75_inp,\n  ROUND(p75_lcp, 0) as p75_lcp,\n  ROUND(p75_cls, 2) as p75_cls,\n  CASE\n    WHEN p75_lcp <= 2500 AND p75_inp <= 200 AND p75_cls <= 0.10 THEN 'PASS'\n    ELSE 'FAIL'\n  END as cwv_status\nFROM `dealeron-crux.dealeron_crux.cwv_monthly`\nWHERE yyyymm = (SELECT MAX(yyyymm) FROM `dealeron-crux.dealeron_crux.cwv_monthly`)\nAND device IN (${device:sqlstring})\nAND p75_inp IS NOT NULL\nORDER BY p75_inp DESC\nLIMIT 25",
          "rawQuery": true,
          "editorMode": "code",
          "format": 1
        }
      ],
      "fieldConfig": {
        "defaults": {},
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "p75_inp" },
            "properties": [
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    { "color": "green", "value": null },
                    { "color": "yellow", "value": 200 },
                    { "color": "red", "value": 500 }
                  ]
                }
              },
              { "id": "custom.displayMode", "value": "color-background" },
              { "id": "custom.cellOptions", "value": { "type": "color-background" } }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "p75_lcp" },
            "properties": [
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    { "color": "green", "value": null },
                    { "color": "yellow", "value": 2500 },
                    { "color": "red", "value": 4000 }
                  ]
                }
              },
              { "id": "custom.displayMode", "value": "color-background" },
              { "id": "custom.cellOptions", "value": { "type": "color-background" } }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "p75_cls" },
            "properties": [
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    { "color": "green", "value": null },
                    { "color": "yellow", "value": 0.10 },
                    { "color": "red", "value": 0.25 }
                  ]
                }
              },
              { "id": "custom.displayMode", "value": "color-background" },
              { "id": "custom.cellOptions", "value": { "type": "color-background" } }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "cwv_status" },
            "properties": [
              {
                "id": "mappings",
                "value": [
                  { "type": "value", "options": { "PASS": { "text": "PASS", "color": "green" }, "FAIL": { "text": "FAIL", "color": "red" } } }
                ]
              },
              { "id": "custom.displayMode", "value": "color-background" },
              { "id": "custom.cellOptions", "value": { "type": "color-background" } }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "origin" },
            "properties": [
              {
                "id": "links",
                "value": [
                  {
                    "title": "Drilldown",
                    "url": "/d/site-drilldown/site-drilldown?var-origin=${__data.fields.origin}&from=now-2y&to=now"
                  }
                ]
              }
            ]
          }
        ]
      },
      "options": {
        "showHeader": true,
        "sortBy": [
          { "displayName": "p75_inp", "desc": true }
        ],
        "footer": { "show": false }
      }
    },
    {
      "type": "row",
      "title": "Worst CLS Sites",
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 33 },
      "id": 103,
      "panels": []
    },
    {
      "id": 6,
      "title": "Worst CLS \u2014 Top 25",
      "description": "Sites with the highest P75 Cumulative Layout Shift (threshold: 0.10 good, 0.25 poor)",
      "type": "table",
      "gridPos": { "h": 12, "w": 24, "x": 0, "y": 34 },
      "datasource": { "type": "grafana-bigquery-datasource", "uid": "dealeron-bigquery" },
      "targets": [
        {
          "refId": "A",
          "datasource": { "type": "grafana-bigquery-datasource", "uid": "dealeron-bigquery" },
          "rawSql": "SELECT\n  origin,\n  dealer_name,\n  oem_brand,\n  state,\n  device,\n  ROUND(p75_cls, 2) as p75_cls,\n  ROUND(p75_lcp, 0) as p75_lcp,\n  ROUND(p75_inp, 0) as p75_inp,\n  CASE\n    WHEN p75_lcp <= 2500 AND p75_inp <= 200 AND p75_cls <= 0.10 THEN 'PASS'\n    ELSE 'FAIL'\n  END as cwv_status\nFROM `dealeron-crux.dealeron_crux.cwv_monthly`\nWHERE yyyymm = (SELECT MAX(yyyymm) FROM `dealeron-crux.dealeron_crux.cwv_monthly`)\nAND device IN (${device:sqlstring})\nAND p75_cls IS NOT NULL\nORDER BY p75_cls DESC\nLIMIT 25",
          "rawQuery": true,
          "editorMode": "code",
          "format": 1
        }
      ],
      "fieldConfig": {
        "defaults": {},
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "p75_cls" },
            "properties": [
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    { "color": "green", "value": null },
                    { "color": "yellow", "value": 0.10 },
                    { "color": "red", "value": 0.25 }
                  ]
                }
              },
              { "id": "custom.displayMode", "value": "color-background" },
              { "id": "custom.cellOptions", "value": { "type": "color-background" } }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "p75_lcp" },
            "properties": [
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    { "color": "green", "value": null },
                    { "color": "yellow", "value": 2500 },
                    { "color": "red", "value": 4000 }
                  ]
                }
              },
              { "id": "custom.displayMode", "value": "color-background" },
              { "id": "custom.cellOptions", "value": { "type": "color-background" } }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "p75_inp" },
            "properties": [
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    { "color": "green", "value": null },
                    { "color": "yellow", "value": 200 },
                    { "color": "red", "value": 500 }
                  ]
                }
              },
              { "id": "custom.displayMode", "value": "color-background" },
              { "id": "custom.cellOptions", "value": { "type": "color-background" } }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "cwv_status" },
            "properties": [
              {
                "id": "mappings",
                "value": [
                  { "type": "value", "options": { "PASS": { "text": "PASS", "color": "green" }, "FAIL": { "text": "FAIL", "color": "red" } } }
                ]
              },
              { "id": "custom.displayMode", "value": "color-background" },
              { "id": "custom.cellOptions", "value": { "type": "color-background" } }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "origin" },
            "properties": [
              {
                "id": "links",
                "value": [
                  {
                    "title": "Drilldown",
                    "url": "/d/site-drilldown/site-drilldown?var-origin=${__data.fields.origin}&from=now-2y&to=now"
                  }
                ]
              }
            ]
          }
        ]
      },
      "options": {
        "showHeader": true,
        "sortBy": [
          { "displayName": "p75_cls", "desc": true }
        ],
        "footer": { "show": false }
      }
    }
  ]
}